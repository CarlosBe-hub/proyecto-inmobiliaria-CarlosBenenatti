@model IEnumerable<ProyectoInmobiliaria.Models.Inmueble>

@{
    ViewData["Title"] = "Inmuebles";

    // Lista de estados 
    var estados = new List<string> { "Disponible", "En Mantenimiento"}; 
    var estadoSeleccionado = ViewBag.EstadoSeleccionado as string;
    int paginaActual = ViewBag.PaginaActual ?? 1;
    int totalPaginas = ViewBag.TotalPaginas ?? 1;
}

<h2 class="mb-4">Inmuebles</h2>

<!-- Mostrar mensajes de error o éxito -->
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        @TempData["Success"]
    </div>
}

<p>
    <a asp-action="Create" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> + Nuevo Inmueble
    </a>
</p>

<!-- Filtro por estado -->
<div class="mb-3">
    <label><strong>Filtrar por estado:</strong></label><br />
    <form asp-action="Index" method="get" class="d-inline">
        <select name="estado" class="form-select d-inline w-auto">
            <option value="">-- Todos --</option>
            @foreach (var estado in estados)
            {
                if (estado == estadoSeleccionado)
                {
                    <option value="@estado" selected="selected">@estado</option>
                }
                else
                {
                    <option value="@estado">@estado</option>
                }
            }
        </select>
        <button type="submit" class="btn btn-primary btn-sm">Filtrar</button>
        <a asp-action="Index" class="btn btn-secondary btn-sm">Limpiar</a>
    </form>
</div>

<table class="table table-hover table-bordered align-middle">
    <thead class="table-dark">
        <tr>
            <th>@Html.DisplayNameFor(m => m.First().Direccion)</th>
            <th>@Html.DisplayNameFor(m => m.First().TipoInmueble)</th>
            <th>@Html.DisplayNameFor(m => m.First().Estado)</th>
            <th>@Html.DisplayNameFor(m => m.First().Precio)</th>
            <th>Propietario</th>
            <th class="text-center">Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Direccion</td>
                <td>@item.TipoInmueble</td>
                <td>@item.Estado</td>
                <td>@item.Precio?.ToString("C")</td>
                <td>@item.Propietario?.NombreCompleto</td>
                <td class="text-center">
                    <a asp-action="Details" asp-route-id="@item.IdInmueble" class="btn btn-info btn-sm text-white">
                        <i class="bi bi-eye"></i> Detalles
                    </a>
                    <a asp-action="Edit" asp-route-id="@item.IdInmueble" class="btn btn-warning btn-sm text-dark">
                        <i class="bi bi-pencil-square"></i> Editar
                    </a>
                    <a asp-action="Delete" asp-route-id="@item.IdInmueble" class="btn btn-danger btn-sm">
                        <i class="bi bi-trash"></i> Eliminar
                    </a>
                    <!-- Botón para ver contratos asociados al inmueble -->
                    <a asp-action="Contratos" asp-route-id="@item.IdInmueble" class="btn btn-primary btn-sm">
                        <i class="bi bi-file-earmark-text"></i> Contratos
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Paginación -->
<nav>
    <ul class="pagination">
        <li class="page-item @(paginaActual == 1 ? "disabled" : "")">
            <a class="page-link" asp-action="Index" asp-route-pagina="@(paginaActual - 1)" asp-route-estado="@estadoSeleccionado">Anterior</a>
        </li>
        @for (int i = 1; i <= totalPaginas; i++)
        {
            <li class="page-item @(i == paginaActual ? "active" : "")">
                <a class="page-link" asp-action="Index" asp-route-pagina="@i" asp-route-estado="@estadoSeleccionado">@i</a>
            </li>
        }
        <li class="page-item @(paginaActual == totalPaginas ? "disabled" : "")">
            <a class="page-link" asp-action="Index" asp-route-pagina="@(paginaActual + 1)" asp-route-estado="@estadoSeleccionado">Siguiente</a>
        </li>
    </ul>
</nav>
